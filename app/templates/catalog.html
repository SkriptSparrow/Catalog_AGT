
{% extends 'base.html' %}

{% block title %}
<title>–ê–≥—Ä–æ—Ç–µ–∫ –ö–∞—Ç–∞–ª–æ–≥</title>
{% endblock %}

{% block body %}

		<!-- Header Area -->
		<header class="header" >
			<!-- Header Inner -->
			<div class="header-inner">
				<div class="container">
					<div class="inner">
						<div class="row">
							<div class="col-lg-3 col-md-3 col-12">
								<!-- Start Logo -->
								<div class="logo">
									<a href="/home"><img src="{{ url_for('static', filename='img/logo-header.png') }}" alt="–õ–æ–≥–æ—Ç–∏–ø –ê–≥—Ä–æ—Ç–µ–∫"></a>
								</div>
								<!-- End Logo -->
								<!-- Mobile Nav -->
								<div class="mobile-nav"></div>
								<!-- End Mobile Nav -->
							</div>
							<div class="col-lg-7 col-md-9 col-12">
								<!-- Main Menu -->
								<div class="main-menu">
									<nav class="navigation">
										<ul class="nav menu">
											<li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
											<li class="active"><a href="/catalog">–ö–∞—Ç–∞–ª–æ–≥</a></li>
											<li><a href="/blog">–ë–ª–æ–≥</a></li>
											<li><a href="/about">–û –Ω–∞—Å</a></li>
											<li><a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
											<li class="mobile-only">
												{% if current_user.is_authenticated %}
													<a href="{{ url_for('prof.profile') }}" class="btn btn-mobile">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
												{% else %}
													<a href="{{ url_for('auth.user_login') }}" class="btn btn-mobile">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</a>
												{% endif %}
											</li>
										</ul>
									</nav>
								</div>
								<!--/ End Main Menu -->
							</div>

							<div class="col-lg-2 col-12">
								<div class="get-quote">
									{% if current_user.is_authenticated %}
										<a href="{{ url_for('prof.profile') }}" class="btn">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
									{% else %}
										<a href="{{ url_for('auth.user_login') }}" class="btn">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--/ End Header Inner -->
		</header>
		<!-- End Header Area -->

		<!--Catalog Page-->
		<section class="pf-details section">
			<div class="container">
		<!-- Search-->
			<div class="catalog-filters">
			<!-- Search by name or article -->
			  <form method="get" action="{{ url_for('main.catalog') }}" class="search-form">
				<input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª—É" value="{{ request.args.get('q', '') }}">
				<button type="submit"><i class="icofont-search"></i></button>
			  </form>
			<!-- Filters: sort, type, category, brand, price -->
			  <form method="get" action="{{ url_for('main.catalog') }}" class="filter-form">
				<input type="hidden" name="q" value="{{ request.args.get('q', '') }}">

				<!-- Sorting -->
				<select name="sort" onchange="this.form.submit()">
				  <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
				  <option value="name_asc" {% if request.args.get('sort') == 'name_asc' %}selected{% endif %}>–ò–º—è: –ê ‚Üí –Ø</option>
				  <option value="name_desc" {% if request.args.get('sort') == 'name_desc' %}selected{% endif %}>–ò–º—è: –Ø ‚Üí –ê</option>
				  <option value="price_asc" {% if request.args.get('sort') == 'price_asc' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üë</option>
				  <option value="price_desc" {% if request.args.get('sort') == 'price_desc' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üì</option>
				</select>

				<!-- Filters -->
				<select name="type" onchange="this.form.submit()">
				  <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
				  {% for t in types %}
					<option value="{{ t }}" {% if request.args.get('type') == t %}selected{% endif %}>{{ t }}</option>
				  {% endfor %}
				</select>

				<select name="category" onchange="this.form.submit()">
				  <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
				  {% for c in categories %}
					<option value="{{ c }}" {% if request.args.get('category') == c %}selected{% endif %}>{{ c }}</option>
				  {% endfor %}
				</select>

				<select name="brand" onchange="this.form.submit()">
				  <option value="">–í—Å–µ –º–∞—Ä–∫–∏</option>
				  {% for b in brands %}
					<option value="{{ b.id }}" {% if request.args.get('brand') == b.id|string %}selected{% endif %}>{{ b.name }}</option>
				  {% endfor %}
				</select>
				<div class="dropdown price-filter">
				  <button type="button" class="price_btn">
					–¶–µ–Ω–∞, ‚ÇΩ <i class="icofont-simple-down"></i>
				  </button>

				  <div class="dropdown-menu custom-price">
					<label>–û—Ç</label>
					<input type="number" name="price_min" min="0" value="{{ request.args.get('price_min', '') }}">

					<label>–î–æ</label>
					<input type="number" name="price_max" min="0" value="{{ request.args.get('price_max', '') }}">

					<button type="submit">–ì–æ—Ç–æ–≤–æ</button>
				  </div>
				</div>
			  </form>
			</div>

		<!--Tile of product catalog from db-->
				<div class="products_grid">
				  {% for product in products %}
					<!-- Product tile (with image, name, category, price, article) -->
					<div class="product_card_cell">
					  <div class="card h-100 shadow-sm">
						{% if product.photo_filename %}
						  <a href="{{ url_for('main.product_card', product_id=product.id) }}" class="product-link" target="_blank">
						  	<img src="{{ url_for('static', filename='uploads/' + product.photo_filename) }}"
								 class="card-img-top" style="object-fit: cover;">
						  </a>
						{% endif %}
						<div class="card-body d-flex flex-column justify-content-between">
						  <h5 class="card-title">
							  <a href="{{ url_for('main.product_card', product_id=product.id) }}" class="product-name-link">
								{{ product.name }}
							  </a>
						  </h5>

						  <p class="card-type text-center text-muted">
							 {{ product.category }} —Ñ–∏–ª—å—Ç—Ä
						  </p>

						  <p class="card_price">
							{{ product.price }} ‚ÇΩ
						  </p>

						  <div class="card-bottom d-flex justify-content-between align-items-center">
							  {% if current_user.is_authenticated %}
								{% set item = user_cart_items.get(product.id) %}

								{% if item %}
								  <!-- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
								  <div class="cart-quantity ms-3" data-product-id="{{ product.id }}">
									<button class="qty-btn minus">‚àí</button>
									<span class="qty-count">{{ item.quantity }}</span>
									<button class="qty-btn plus">+</button>
								  </div>
								{% else %}
								  <!-- –ï—Å–ª–∏ –µ—â—ë –Ω–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
								  <button class="btn btn-cart-icon ms-3"
										  data-product-id="{{ product.id }}"
										  data-auth="true"
										  style="background: none; border: none; padding: 0;">
									<i class="icofont-cart cart-icon"></i>
								  </button>
								{% endif %}

							  {% else %}
								<!-- –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
								<button class="btn btn-cart ms-3"
										data-product-id="{{ product.id }}"
										data-auth="false">
								  üõí –í –∫–æ—Ä–∑–∏–Ω—É
								</button>
							  {% endif %}

							  <p class="card-text text-center small text-secondary m-0">–ê—Ä—Ç: {{ product.article }}</p>
							</div>

						</div>
					  </div>
					</div>
				  {% else %}
					<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
				  {% endfor %}
				</div>
			</div>
		</section>
		<!-- End of product catalog section -->

		<!-- JS: Toggle price filter dropdown -->
			<script>
		  document.addEventListener('DOMContentLoaded', function () {
			const toggle = document.querySelector('.price-filter .price_btn');
			const container = document.querySelector('.price-filter');

			toggle.addEventListener('click', function () {
			  container.classList.toggle('show');
			});

			document.addEventListener('click', function (e) {
			  if (!container.contains(e.target)) {
				container.classList.remove('show');
			  }
			});
		  });
		</script>
{% endblock %}