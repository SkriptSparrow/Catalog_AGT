
{% extends 'base.html' %}

{% block title %}
<title>{{ product.name }}</title>
{% endblock %}

{% block body %}

		<!-- Header Area -->
		<header class="header" >
			<!-- Header Inner -->
			<div class="header-inner">
				<div class="container">
					<div class="inner">
						<div class="row">
							<div class="col-lg-3 col-md-3 col-12">
								<!-- Start Logo -->
								<div class="logo">
									<a href="/home"><img src="{{ url_for('static', filename='/img/logo-header.png') }}" alt="#"></a>
								</div>
								<!-- End Logo -->
								<!-- Mobile Nav -->
								<div class="mobile-nav"></div>
								<!-- End Mobile Nav -->
							</div>
							<div class="col-lg-7 col-md-9 col-12">
								<!-- Main Menu -->
								<div class="main-menu">
									<nav class="navigation">
										<ul class="nav menu">
											<li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
											<li><a href="/catalog">–ö–∞—Ç–∞–ª–æ–≥</a></li>
											<li><a href="/blog">–ë–ª–æ–≥</a></li>
											<li><a href="/about">–û –Ω–∞—Å</a></li>
											<li><a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
											<li class="mobile-only">
												{% if current_user.is_authenticated %}
													<a href="{{ url_for('prof.profile') }}" class="btn btn-mobile">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
												{% else %}
													<a href="{{ url_for('auth.user_login') }}" class="btn btn-mobile">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</a>
												{% endif %}
											</li>
										</ul>
									</nav>
								</div>
								<!--/ End Main Menu -->
							</div>

							<div class="col-lg-2 col-12">
								<div class="get-quote">
									{% if current_user.is_authenticated %}
										<a href="{{ url_for('prof.profile') }}" class="btn">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
									{% else %}
										<a href="{{ url_for('auth.user_login') }}" class="btn">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--/ End Header Inner -->
		</header>
		<!-- End Header Area -->

    <!-- Product Card -->
		<section class="prod_card">
			<div class="card_of_product">
			  <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å —Å —Ñ–æ—Ç–æ -->
			  <div class="left_photo_of_product">
				{% if product.photo_filename %}
				  <img src="{{ url_for('static', filename='uploads/' + product.photo_filename) }}" alt="–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞">
				{% else %}
				  <img src="{{ url_for('static', filename='img/default-product.png') }}" alt="–ù–µ—Ç —Ñ–æ—Ç–æ">
				{% endif %}
			  </div>

			  <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å —Å —Ç–µ–∫—Å—Ç–æ–º -->
			  <div class="right_info_of_product show-icon">
				  <i class="corner-icon icofont-gear"></i>
				  <div class="name_row">
					  <p class="name_prod">{{ product.name }}</p>
				  </div>
				  {% set item = user_cart_items.get(product.id) %}
					  <div class="field-row_price d-flex align-items-center">
						  <span class="price-text">{{ product.price }} ‚ÇΩ</span>

						  {% if current_user.is_authenticated %}
							  {% if item %}
								  <!-- –¢–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
								  <div class="cart-quantity ms-3" data-product-id="{{ product.id }}">
									  <button class="qty-btn minus">‚àí</button>
									  <span class="qty-count">{{ item.quantity }}</span>
									  <button class="qty-btn plus">+</button>
								  </div>
							  {% else %}
								  <!-- –¢–æ–≤–∞—Ä –µ—â—ë –Ω–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
								  <button class="btn btn-cart-icon ms-3"
										  data-product-id="{{ product.id }}"
										  data-auth="true"
										  style="background: none; border: none; padding: 0;">
									  <i class="icofont-cart cart-icon"></i>
								  </button>
							  {% endif %}
						  {% else %}
							  <button class="btn btn-cart ms-3"
									  data-product-id="{{ product.id }}"
									  data-auth="false">
								üõí –í –∫–æ—Ä–∑–∏–Ω—É
							  </button>
						  {% endif %}
					  </div>
				  <div class="field-row_options">–ê—Ä—Ç–∏–∫—É–ª: <strong>{{product.article }}</strong></div>
				  <div class="field-row_type">–¢–∏–ø —Ñ–∏–ª—å—Ç—Ä–∞: <strong>{{ product.category }}</strong></div>
				  <div class="field-row_options">–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ: <strong>{{ product.brand.name }}</strong></div>
				  <div class="field-row_options">–¢–∏–ø —Ç–µ—Ö–Ω–∏–∫–∏: <strong>{{ product.type }}</strong></div>
				  <div class="field-row_type">–ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: <strong>{{ product.full_marking }}</strong></div>
				  <div class="field-row">
				      <span class="label">–û–ø–∏—Å–∞–Ω–∏–µ:</span>
				      <p class="short-text" id="description">
					    {{ product.description }}
				      </p>
				      <a href="#" class="read-more" onclick="toggleDescription(event)">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ...</a>
				  </div>
				  <div class="product-meta">
					  <button class="btn btn-share1" onclick="copyLinkAndChangeText(this)" type="button">
						  –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
					  </button>
				  </div>
			  </div>
			</div>
		</section>
		<form id="copy-link-form" action="{{ url_for('main.copy_link') }}" method="post" style="display: none;">
		  <input type="hidden" name="return_url" value="{{ request.path }}">
		</form>
		<script>
		  function copyLinkAndChangeText(button) {
			const originalText = button.textContent;
			navigator.clipboard.writeText(window.location.href)
			  .then(() => {
				button.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
				button.disabled = true;

				setTimeout(() => {
				  button.textContent = originalText;
				  button.disabled = false;
				}, 2000);
			  })
			  .catch(err => {
				console.error("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:", err);
				button.textContent = "–û—à–∏–±–∫–∞";
				setTimeout(() => {
				  button.textContent = originalText;
				}, 2000);
			  });
		  }
		</script>

    <!-- End Product Card -->
			<script>
			  function toggleDescription(e) {
				e.preventDefault();
				const link = e.target;
				const container = link.closest('.field-row');
				const text = container.querySelector('.short-text');

				text.classList.toggle('expanded');
				link.textContent = text.classList.contains('expanded') ? '–°–∫—Ä—ã—Ç—å' : '–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ';
			  }
			</script>
{% endblock %}